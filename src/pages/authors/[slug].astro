---
export const prerender = true;

import {
  generateAuthorPaths,
  generateAuthorSEO,
  getSiteSettings,
  getPostsByAuthorSlug,
  getAuthorTagsBySlug,
} from "../../core/blogLogic";
import BaseLayout from "../../layouts/BaseLayout.astro";
import BlogList from "../../components/blog/BlogList.astro";
import Breadcrumb from "../../components/navigation/Breadcrumb.astro";
import AuthorSchema from "../../components/seo/AuthorSchema.astro";
import { getAuthorBreadcrumbs } from "../../core/navigation/breadcrumbUtils";

export const getStaticPaths = generateAuthorPaths;

const { author } = Astro.props;
const { slug } = Astro.params;

const settings = await getSiteSettings();
const authorPosts = await getPostsByAuthorSlug(slug);
const authorTags = await getAuthorTagsBySlug(slug);
const seoData = await generateAuthorSEO(author);
const breadcrumbs = getAuthorBreadcrumbs(slug, author);
const currentUrl = `${settings.siteUrl}${Astro.url.pathname}`;
---

<BaseLayout pageTitle={seoData.pageTitle} description={seoData.description}>
  {
    settings.imageDomain && (
      <link rel="preconnect" href={settings.imageDomain} slot="head" />
    )
  }

  <AuthorSchema
    author={author}
    url={currentUrl}
    postCount={authorPosts.length}
    slot="head"
  />

  <section style="background: var(--bg-secondary); padding: 3rem 0;">
    <div
      style="max-width: var(--container-max-width); margin: 0 auto; padding: 0 1rem;"
    >
      <Breadcrumb items={breadcrumbs} />

      <div class="text-center max-w-3xl mx-auto">
        <!-- Author Avatar -->
        <div class="mb-8">
          {
            author.data.avatar ? (
              <img
                src={author.data.avatar}
                alt={author.data.name}
                loading="eager"
                class="w-32 h-32 mx-auto object-cover border-4 rounded-full"
                style="border-color: var(--surface-card); box-shadow: var(--shadow-lg);"
              />
            ) : (
              <div
                class="w-32 h-32 flex items-center justify-center mx-auto text-3xl font-bold border-4 rounded-full"
                style="color: var(--bg-primary); background: var(--color-primary); border-color: var(--surface-card); box-shadow: var(--shadow-lg);"
              >
                {author.data.name[0].toUpperCase()}
              </div>
            )
          }
        </div>

        <!-- Professional Badge -->
        <div
          class="inline-flex items-center gap-2 px-4 py-2 mb-6 rounded-full border"
          style="background: var(--color-primary)/10; color: var(--color-primary); border-color: var(--color-primary)/20;"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
            ></path>
          </svg>
          <span class="text-sm font-semibold">Author</span>
        </div>

        <h1
          class="text-4xl lg:text-5xl font-bold mb-4"
          style="color: var(--text-primary); font-family: var(--font-heading);"
        >
          {author.data.name}
        </h1>

        <p class="text-lg mb-6" style="color: var(--text-secondary);">
          Author at {settings.siteName}
        </p>

        {
          author.data.bio && (
            <p
              class="text-lg leading-relaxed mb-8 max-w-2xl mx-auto"
              style="color: var(--text-secondary);"
            >
              {author.data.bio}
            </p>
          )
        }

        {
          (author.data.twitter ||
            author.data.github ||
            author.data.website ||
            author.data.email) && (
            <div class="flex flex-wrap justify-center gap-4">
              {author.data.email && (
                <a
                  href={`mailto:${author.data.email}`}
                  class="inline-flex items-center gap-2 px-6 py-3 font-semibold border rounded-xl hover:-translate-y-1 transition-all"
                  style="background: var(--surface-card); color: var(--text-secondary); border-color: var(--border-default); box-shadow: var(--shadow-sm); transition-duration: var(--animation-duration);"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                    />
                  </svg>
                  Contact
                </a>
              )}
              {author.data.twitter && (
                <a
                  href={`https://twitter.com/${author.data.twitter}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center gap-2 px-6 py-3 font-semibold border rounded-xl hover:-translate-y-1 transition-all"
                  style="background: var(--surface-card); color: var(--text-secondary); border-color: var(--border-default); box-shadow: var(--shadow-sm); transition-duration: var(--animation-duration);"
                >
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z" />
                  </svg>
                  Twitter
                </a>
              )}
              {author.data.github && (
                <a
                  href={`https://github.com/${author.data.github}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center gap-2 px-6 py-3 font-semibold border rounded-xl hover:-translate-y-1 transition-all"
                  style="background: var(--surface-card); color: var(--text-secondary); border-color: var(--border-default); box-shadow: var(--shadow-sm); transition-duration: var(--animation-duration);"
                >
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                  </svg>
                  GitHub
                </a>
              )}
              {author.data.website && (
                <a
                  href={author.data.website}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center gap-2 px-6 py-3 font-semibold border rounded-xl hover:-translate-y-1 transition-all"
                  style="background: var(--surface-card); color: var(--text-secondary); border-color: var(--border-default); box-shadow: var(--shadow-sm); transition-duration: var(--animation-duration);"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"
                    />
                  </svg>
                  Website
                </a>
              )}
            </div>
          )
        }
      </div>
    </div>
  </section>

  {
    authorPosts.length > 0 ? (
      <section style="padding: 4rem 0; background: var(--bg-secondary);">
        <div style="max-width: var(--container-max-width); margin: 0 auto; padding: 0 1rem;">
          <div class="text-center mb-12">
            <h2
              class="text-2xl font-bold mb-2"
              style="color: var(--text-primary); font-family: var(--font-heading);"
            >
              Articles by {author.data.name}
            </h2>
            <p style="color: var(--text-secondary);">
              Discover the unique insights and expertise shared by our author
            </p>
          </div>
          <BlogList posts={authorPosts} />
        </div>
      </section>
    ) : (
      <div style="padding: 4rem 0; background: var(--bg-secondary);">
        <div style="max-width: var(--container-max-width); margin: 0 auto; padding: 0 1rem;">
          <div class="text-center max-w-md mx-auto">
            <div
              class="w-16 h-16 flex items-center justify-center mx-auto mb-4 rounded-full"
              style="background: var(--bg-tertiary);"
            >
              <div
                class="w-8 h-8 rounded-sm"
                style="background: var(--text-muted);"
              />
            </div>
            <h3
              class="text-xl font-semibold mb-2"
              style="color: var(--text-primary); font-family: var(--font-heading);"
            >
              No Articles Yet
            </h3>
            <p class="mb-6" style="color: var(--text-secondary);">
              {author.data.name} is still working on their first articles. Check
              back soon for fresh content!
            </p>
            <a
              href="/authors"
              class="inline-flex items-center font-medium transition-colors"
              style="color: var(--color-primary); transition-duration: var(--animation-duration);"
            >
              ← Meet Other Authors
            </a>
          </div>
        </div>
      </div>
    )
  }
</BaseLayout>
