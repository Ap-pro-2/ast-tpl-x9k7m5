---
export const prerender = true;

import { getCollection, render } from "astro:content";
import { getSiteSettings } from "../../core/blogLogic";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Breadcrumb from "../../components/navigation/Breadcrumb.astro";
import { generateBreadcrumbs } from "../../core/navigation/breadcrumbUtils";
import { formatDate } from "../../core/blogLogic";

// âœ… CLEAN: Simple static paths 
export async function getStaticPaths() {
  const legalEntries = await getCollection("legal");
  return legalEntries.map((entry) => ({
    params: { slug: entry.id },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);
const settings = await getSiteSettings();

// Enhanced SEO data
const seoData = {
  pageTitle: entry.data.seo?.title || `${entry.data.title} | ${settings.siteName}`,
  description: entry.data.seo?.description || entry.data.description || `${entry.data.title} - Legal information`,
  keywords: entry.data.seo?.keywords || [],
  ogImage: entry.data.seo?.ogImage || settings.defaultOgImage,
  ogImageAlt: `${entry.data.title} - AstroPress Coffee`,
  canonicalUrl: `${settings.siteUrl}/legal/${entry.id}`
};

const formattedDate = entry.data.pubDate ? formatDate(entry.data.pubDate) : null;
const breadcrumbs = generateBreadcrumbs(`/legal/${entry.data.title}`);
---

<BaseLayout 
  pageTitle={seoData.pageTitle} 
  description={seoData.description}
  keywords={seoData.keywords}
  ogImage={seoData.ogImage}
  ogImageAlt={seoData.ogImageAlt}
  canonicalUrl={seoData.canonicalUrl}
>
  <div class="py-6 sm:py-8 lg:py-12 xl:py-16">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <main>
        <div class="mb-4 sm:mb-6">
          <Breadcrumb items={breadcrumbs} />
        </div>
        
        <article class="theme-card overflow-hidden">
          <!-- Header -->
          <div class="p-4 sm:p-6 lg:p-8 xl:p-12 pb-4 sm:pb-6 lg:pb-8">
            <h1 class="text-2xl sm:text-3xl lg:text-4xl xl:text-5xl font-bold mb-6 sm:mb-8 leading-tight" 
                style="color: var(--text-primary); font-family: var(--font-heading)">
              {entry.data.title}
            </h1>
            
            {formattedDate && (
              <div class="mb-6 pb-4" style="border-bottom: 1px solid var(--border-light)">
                <time datetime={entry.data.pubDate.toISOString()} 
                      class="text-sm flex items-center gap-2" 
                      style="color: var(--text-secondary)">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                  Last updated: {formattedDate}
                </time>
              </div>
            )}
          </div>
          
          <!-- Content -->
          <div class="px-4 sm:px-6 lg:px-8 xl:px-12 pb-6 sm:pb-8 lg:pb-12">
            <!-- Centered Content Container -->
            <div class="max-w-3xl mx-auto">
              <div class="prose prose-lg w-full" 
                   style="--tw-prose-headings: var(--text-primary); 
                          --tw-prose-body: var(--text-secondary); 
                          --tw-prose-links: var(--color-primary); 
                          --tw-prose-strong: var(--text-primary); 
                          --tw-prose-bold: var(--text-primary);
                          --tw-prose-ul: var(--text-secondary); 
                          --tw-prose-ol: var(--text-secondary); 
                          --tw-prose-li: var(--text-secondary);
                          --tw-prose-code: var(--color-primary);
                          --tw-prose-pre-code: var(--text-primary);
                          --tw-prose-pre-bg: var(--bg-tertiary);
                          --tw-prose-th-borders: var(--border-default);
                          --tw-prose-td-borders: var(--border-light);
                          --tw-prose-blockquote-borders: var(--color-primary);
                          --tw-prose-hr: var(--border-default);
                          --tw-prose-quote-borders: var(--color-primary);
                          --tw-prose-captions: var(--text-muted);
                          --tw-prose-kbd: var(--text-primary);
                          --tw-prose-kbd-shadows: var(--color-primary);
                          font-family: var(--font-body);
                          line-height: 1.75;">
                <Content />
              </div>
              
              <!-- Back to Home Link -->
              <div class="mt-12 pt-8 text-center" style="border-top: 1px solid var(--border-light)">
                <a href="/" 
                   class="inline-flex items-center gap-2 px-4 py-2 font-medium transition-all duration-300 rounded-lg" 
                   style="color: var(--color-primary); background: var(--bg-tertiary); border: 1px solid var(--border-light); transition: all var(--animation-duration) var(--animation-easing)"
                   onmouseover="this.style.backgroundColor='var(--color-primary)'; this.style.color='white'; this.style.transform='translateY(-1px)'"
                   onmouseout="this.style.backgroundColor='var(--bg-tertiary)'; this.style.color='var(--color-primary)'; this.style.transform='translateY(0)'">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                  </svg>
                  Back to Home
                </a>
              </div>
            </div>
          </div>
        </article>
      </main>
    </div>
  </div>
</BaseLayout>